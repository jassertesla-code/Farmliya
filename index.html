<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>APP JOJO ♡ JASSER</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#0f0520; --bg2:#2b004d; --accent:#ff62b3; --paper:#fff8f5; --text-dark:#3b2340;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh;
    font-family:'Cairo',sans-serif;
    background: radial-gradient(1000px 600px at 10% 10%, rgba(255,95,180,0.06), transparent),
                linear-gradient(180deg,var(--bg1),var(--bg2));
    color:#fff;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:28px;
    overflow-x:hidden;
  }

  /* header */
  .header {
    width:100%; max-width:920px; display:flex; justify-content:center; align-items:center; flex-direction:column;
    margin-top:6px;
  }
  .title {
    margin-top:12px;
    font-size:32px;
    font-weight:900;
    letter-spacing:1px;
    color:#fff;
    text-shadow: 0 8px 30px rgba(255,80,150,0.12);
    opacity:0;
    transform: translateY(-30px);
    animation: slideDown 700ms cubic-bezier(.2,.9,.2,1) 300ms forwards;
    background: linear-gradient(90deg,#ffd6fb,#ff7ab6 40%, #ffd6fb 100%);
    -webkit-background-clip: text; background-clip: text; color: transparent;
  }
  @keyframes slideDown { to { transform: translateY(0); opacity:1; } }

  .heart {
    margin-top:8px;
    width:70px;height:70px;border-radius:999px;
    background:linear-gradient(180deg,#ff7ab6,#ff3b90);
    display:flex;align-items:center;justify-content:center;font-weight:900;color:#fff;
    box-shadow:0 14px 40px rgba(255,70,150,0.12);
    position:relative;
  }
  .heart .date { font-size:11px;font-weight:700; text-align:center; line-height:1; }

  /* stage */
  .stage { width:100%; max-width:740px; margin-top:28px; display:flex; justify-content:center; align-items:center; position:relative; padding:20px; }

  /* instruction above gift */
  .gift-instruction {
    position: absolute;
    top: -48px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    padding:10px 16px;
    border-radius:999px;
    font-weight:800;
    color:#ffd6fb;
    box-shadow: 0 8px 24px rgba(0,0,0,0.45);
    backdrop-filter: blur(6px);
    letter-spacing:0.4px;
    animation: popIn 600ms cubic-bezier(.2,.9,.2,1) 600ms both;
  }
  @keyframes popIn {
    from { transform: translateX(-50%) translateY(-6px) scale(0.96); opacity:0; }
    to { transform: translateX(-50%) translateY(0) scale(1); opacity:1; }
  }

  .gift {
    width:300px;
    height:210px;
    position:relative;
    perspective:1200px;
    cursor:pointer;
  }

  .box-base {
    width:100%; height:64%; background: linear-gradient(180deg,#4b002f,#2a001b);
    border-radius:14px; position:absolute; bottom:0; left:0; z-index:6; box-shadow: 0 26px 60px rgba(0,0,0,0.6);
    display:flex; align-items:center; justify-content:center; overflow:visible; transform-origin:center top;
    transition: transform 700ms cubic-bezier(.2,.95,.15,1), opacity 600ms ease;
  }
  .ribbon-vertical { position:absolute; left:50%; transform:translateX(-50%); width:44px; height:100%; border-radius:6px; background: linear-gradient(180deg,#ff9bd1,#ff4aa3); z-index:7; }
  .ribbon-horizontal { position:absolute; top:30%; left:0; width:100%; height:36px; border-radius:8px; background: linear-gradient(90deg,#ff9bd1,#ff4aa3); z-index:7; }
  .bow {
    position:absolute; top:-22px; left:50%; transform:translateX(-50%) rotate(-10deg); width:100px; height:56px; border-radius:20px;
    background: linear-gradient(180deg,#ffd1e8,#ff86c4); z-index:9; box-shadow: 0 8px 26px rgba(255,91,158,0.12);
  }
  .bow:before, .bow:after { content:""; position:absolute; width:36px; height:42px; background:inherit; border-radius:10px; top:8px;}
  .bow:before { left:6px; transform: rotate(-28deg); }
  .bow:after { right:6px; transform: rotate(28deg); }

  .box-lid {
    width:100%; height:50%; position:absolute; top:0; left:0; border-radius:14px; background: linear-gradient(180deg,#6f0045,#3a001f);
    transform-origin: top center; z-index:10; transition: transform 700ms cubic-bezier(.2,.95,.15,1), opacity 600ms ease; box-shadow: 0 26px 40px rgba(0,0,0,0.5);
  }

  .note {
    position:absolute; left:50%; transform:translateX(-50%) translateY(8px) rotate(-8deg);
    top:44%; width:220px; padding:18px; background: var(--paper); color: var(--text-dark);
    border-radius:10px; box-shadow: 0 26px 60px rgba(0,0,0,0.35); opacity:0; z-index:4;
    transform-origin: bottom center; transition: all 900ms cubic-bezier(.2,.9,.2,1); text-align:center; font-weight:700; line-height:1.4;
  }

  .opened .box-lid { transform: translateY(-20px) rotateX(65deg) scale(1.02); opacity:0; }
  .opened .box-base { opacity:0; transform: translateY(12px) scale(0.9); pointer-events:none; }
  .opened .note { opacity:1; top:-26%; transform:translateX(-50%) translateY(0) rotate(0deg); z-index:30; }

  .message { font-size:15px; color:#4b2340; }
  .message .from { display:block; margin-top:10px; font-weight:900; color:#2b1840; font-size:15px; }

  /* comments area */
  .comments {
    width:100%; max-width:740px; margin-top:28px; background: rgba(255,255,255,0.03);
    border-radius:12px; padding:18px; box-shadow:0 8px 30px rgba(0,0,0,0.45);
  }
  .comments h3 { margin:0 0 12px 0; color:#ffd6fb; }
  .comment-form { display:flex; gap:10px; flex-direction:column; }
  .comment-form input[type="text"], .comment-form textarea {
    width:100%; padding:12px; border-radius:8px; border:1px solid rgba(255,255,255,0.06);
    background: rgba(0,0,0,0.25); color:#fff; font-size:15px; resize:vertical;
  }
  .comment-form button {
    align-self:flex-start; padding:10px 14px; border-radius:10px; border:none;
    background: linear-gradient(90deg,#ff9bd1,#ff4aa3); color:#fff; font-weight:800; cursor:pointer;
  }
  .note-small { margin-top:8px; color:#e9dbe9; opacity:0.9; font-size:13px; }

  .comment-list { margin-top:16px; display:flex; flex-direction:column; gap:10px; max-height:260px; overflow:auto; padding-right:6px; }
  .comment-item { background: rgba(255,255,255,0.02); padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); }
  .comment-item .meta { font-size:13px; color:#ffd6fb; font-weight:800; margin-bottom:6px; }
  .comment-item .text { color:#efe7f6; font-size:15px; white-space:pre-wrap; }

  /* overlay waiting */
  .wait-overlay {
    position: fixed;
    inset:0;
    background: linear-gradient(180deg, rgba(10,6,34,0.85), rgba(25,9,60,0.85));
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:1200;
    padding:20px;
  }
  .wait-card{
    width:100%;
    max-width:520px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:14px;
    padding:22px;
    text-align:center;
    box-shadow:0 20px 60px rgba(0,0,0,0.6);
    backdrop-filter: blur(8px);
    color:#ffdff5;
  }
  .wait-title{font-size:20px;font-weight:900;margin-bottom:10px}
  .wait-sub{font-size:15px;opacity:0.95;margin-bottom:16px}

  .progress-wrap{width:100%; background:rgba(255,255,255,0.04); height:14px;border-radius:999px; overflow:hidden}
  .progress-fill{height:100%; width:0%; background:linear-gradient(90deg,#ff9bd1,#ff4aa3); transition:width 0.2s linear}

  /* responsive */
  @media (max-width:480px){
    .gift{width:220px;height:170px;} .note{width:180px; top:44%} .title{font-size:24px} .heart{width:60px;height:60px}
    .wait-card{padding:16px}
  }
</style>
</head>
<body>

  <div class="header">
    <div class="title">APP JOJO ♡ JASSER</div>
    <div style="margin-top:8px;">
      <div class="heart" aria-hidden="true"><div class="date" id="dateInHeart"></div></div>
    </div>
  </div>

  <div class="stage">
    <div class="gift-instruction">اضغطي يا جوجو على الصندوق</div>

    <div class="gift" id="giftCard" title="اضغط لفتح الهدية">
      <div class="box-lid" aria-hidden="true"></div>
      <div class="box-base" aria-hidden="true">
        <div class="ribbon-vertical"></div>
        <div class="ribbon-horizontal"></div>
        <div class="bow" aria-hidden="true"></div>
      </div>

      <div class="note" id="noteCard" role="dialog" aria-hidden="true">
        <div class="message" id="messageText"></div>
        <span class="from">— جَاسِر ❤</span>
      </div>
    </div>
  </div>

  <canvas class="confetti" id="confettiCanvas"></canvas>

  <!-- تعليقات الزوار -->
  <section class="comments" aria-label="منطقة التعليقات">
    <h3>اترك تعليقًا لـ جَاسِر</h3>
    <div class="comment-form" id="commentForm">
      <input type="text" id="commentName" placeholder="اسمك (اختياري)" />
      <textarea id="commentText" rows="4" placeholder="اكتب تعليقك هنا — أي شخص يستطيع التعليق بدون تسجيل"></textarea>
      <div>
        <button id="postCommentBtn">أضف تعليق</button>
        <span class="note-small">التعليقات تُخزّن محليًا في متصفحك (بدون تسجيل). إذا تريد ظهور التعليقات للجميع على الإنترنت نحتاج إضافة خدمة (سيرفر).</span>
      </div>
    </div>

    <div class="comment-list" id="commentList" aria-live="polite"></div>
  </section>

  <!-- WAIT overlay -->
  <div class="wait-overlay" id="waitOverlay" aria-hidden="false">
    <div class="wait-card" role="status" aria-live="polite">
      <div class="wait-title">انتظري 5 ثواني لكي تظهر رسالتك يا جوجو</div>
      <div class="wait-sub">الجميع يحب المفاجآت — انتظري لحظة!</div>
      <div style="margin-top:12px" class="progress-wrap" aria-hidden="false">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div style="margin-top:10px; font-size:13px; color:#ffdfef" id="countdownText">5 ثواني</div>
    </div>
  </div>

<script>
  /* ======== رسائل يومية ======== */
  const messages = [
    "جوجو الحبيبة، كل يومٍ معكِ يكبر قلبي فرحًا — ضحكتكِ نوري.",
    "حبيبتي جوجو، أنتِ الحلم الذي تحقّق في أيامي. أحبكِ بلا حدود.",
    "جوجو الغالية، كل لحظة بقربك أجمل من كل ما مرّ — وأنتِ سر سعادتي.",
    "إلى جوجو، يا أجمل نعمة، شكراً لوجودك؛ أحبكِ بكل نبضة في قلبي.",
    "جوجو، كلامي قد لا يكفيكِ، لكن قلبي يهديكِ عمراً من الحب والوفاء.",
    "يا جوجو، ضحكتكِ موسيقى تُنعش روحي — أنتِ لي كل المعاني.",
    "إلى جوجو، مع كل شروق أراكِ أجمل — لكِ وحدك قلبي وهواي.",
    "جوجو، وجودكِ يجعل كل يوم ينبض أملًا؛ أحبكِ فوق كل وصف.",
    "غاليتي جوجو، كنز قلبي أنتِ، كل يوم أحبك أكثر من البارحة.",
    "جوجو الحبيبة، معكِ تعلمتُ معنى السعادة الحقيقية — دمتِ لي نورًا."
  ];
  function getDayIndex(date = new Date()){
    const msPerDay = 24*60*60*1000;
    const days = Math.floor(date.getTime() / msPerDay);
    return days % messages.length;
  }
  function updateDailyMessage(){
    const idx = getDayIndex(new Date());
    const text = messages[idx];
    document.getElementById('messageText').innerHTML = text;
    localStorage.setItem('last_message_date', new Date().toDateString());
  }

  /* ======== date in heart ======== */
  function showDate(){
    const d = new Date();
    document.getElementById('dateInHeart').textContent =
      d.toLocaleDateString('ar-DZ', { year:'numeric', month:'long', day:'numeric' });
  }
  showDate();

  /* ======== initialize message and schedule midnight update ======== */
  updateDailyMessage();

  /* ======== gift open & confetti (same behavior) ======== */
  const gift = document.getElementById('giftCard');
  const confettiCanvas = document.getElementById('confettiCanvas');
  let opened = false;
  gift.addEventListener('click', ()=> { if(!opened) openGift(); });

  function openGift(){
    if(opened) return;
    opened = true;
    gift.classList.add('opened');
    updateDailyMessage();
    launchConfetti();
    // hide overlay if still visible
    hideOverlayImmediate();
  }

  /* ======== confetti ======== */
  function launchConfetti(){
    try {
      const canvas = confettiCanvas;
      const ctx = canvas.getContext('2d');
      let W = canvas.width = window.innerWidth;
      let H = canvas.height = window.innerHeight;
      const pieces = [];
      const colors = ['#ff5fb4','#ffd166','#7afcff','#8b5cf6','#ff8a66','#ffd6fb'];

      for(let i=0;i<80;i++){
        pieces.push({
          x: Math.random()*W,
          y: Math.random()*H - H*0.3,
          r: 6 + Math.random()*8,
          color: colors[Math.floor(Math.random()*colors.length)],
          tilt: Math.random()*10 - 10,
          tiltAngle: Math.random()*Math.PI
        });
      }

      let t = 0;
      function draw(){
        ctx.clearRect(0,0,W,H);
        for(let p of pieces){
          p.tiltAngle += 0.05;
          p.y += Math.sin(t/10) + 2 + p.r/8;
          p.x += Math.sin(t/20);
          p.tilt = Math.sin(p.tiltAngle) * 15;
          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.tilt * Math.PI/180);
          ctx.fillStyle = p.color;
          ctx.fillRect(-p.r/2, -p.r/2, p.r, p.r*0.6);
          ctx.restore();
        }
        t++;
        if(t < 180) requestAnimationFrame(draw);
        else ctx.clearRect(0,0,W,H);
      }
      draw();
      window.addEventListener('resize', ()=>{ W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; });
    } catch(e){
      console.warn('confetti not supported', e);
    }
  }

  /* ======== wait overlay countdown logic ======== */
  const overlay = document.getElementById('waitOverlay');
  const progressFill = document.getElementById('progressFill');
  const countdownText = document.getElementById('countdownText');

  function hideOverlayImmediate(){
    if(!overlay) return;
    overlay.style.display = 'none';
    overlay.setAttribute('aria-hidden','true');
  }

  function startCountdown(seconds = 5){
    if(!overlay) return;
    overlay.style.display = 'flex';
    overlay.setAttribute('aria-hidden','false');
    progressFill.style.width = '0%';
    let elapsed = 0;
    const tick = 100; // ms
    const totalTicks = (seconds*1000) / tick;
    let currentTick = 0;
    countdownText.textContent = `${seconds} ثواني`;
    const interval = setInterval(()=>{
      currentTick++;
      const percent = Math.min(100, Math.round((currentTick / totalTicks) * 100));
      progressFill.style.width = percent + '%';
      const remaining = Math.max(0, Math.ceil((seconds*1000 - currentTick*tick)/1000));
      countdownText.textContent = remaining + ' ثواني';
      if(currentTick >= totalTicks){
        clearInterval(interval);
        countdownText.textContent = 'انتهى الانتظار';
        // بعد الانتهاء: إخفاء النافذة ثم اظهار الرسالة (بفتح الهدية تلقائياً)
        setTimeout(()=>{
          hideOverlayImmediate();
          // افتح الهدية تلقائياً بدون انتظار نقرة
          openGift();
        }, 250);
      }
    }, tick);
  }

  // ابدأ العد مباشرة عند تحميل الصفحة
  window.addEventListener('load', ()=> {
    // عرض النافذة والعد 5 ثواني عند كل تحميل
    startCountdown(5);
  });

  /* ======== comments logic (same as before) ======== */
  const commentListEl = document.getElementById('commentList');
  const postBtn = document.getElementById('postCommentBtn');
  const nameInput = document.getElementById('commentName');
  const textInput = document.getElementById('commentText');
  const STORAGE_KEY = 'xp_local_comments_v1';

  function escapeHtml(str){
    return str.replace(/[&<>"'`=\/]/g, function(s){ return ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','=':'&#x3D;','`':'&#x60;'
    })[s]; });
  }

  function loadComments(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : [];
    }catch(e){ return []; }
  }

  function saveComments(arr){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
  }

  function renderComments(){
    const comments = loadComments();
    commentListEl.innerHTML = '';
    if(comments.length === 0){
      commentListEl.innerHTML = '<div style="color:#e6d7f2">لا يوجد تعليقات بعد — كن أول من يعلّق!</div>';
      return;
    }
    for(let c of comments.slice().reverse()){
      const item = document.createElement('div');
      item.className = 'comment-item';
      const meta = document.createElement('div');
      meta.className = 'meta';
      meta.textContent = `${escapeHtml(c.name || 'زائر')} — ${escapeHtml(c.date)}`;
      const txt = document.createElement('div');
      txt.className = 'text';
      txt.innerHTML = escapeHtml(c.text);
      item.appendChild(meta);
      item.appendChild(txt);
      commentListEl.appendChild(item);
    }
  }

  postBtn.addEventListener('click', ()=>{
    const name = nameInput.value.trim();
    const text = textInput.value.trim();
    if(!text){
      alert('اكتب تعليقاً أولاً.');
      return;
    }
    const comments = loadComments();
    const obj = { name: name || 'زائر', text: text, date: new Date().toLocaleString('ar-DZ') };
    comments.push(obj);
    saveComments(comments);
    nameInput.value = '';
    textInput.value = '';
    renderComments();
    commentListEl.scrollTop = 0;
  });

  renderComments();
</script>
</body>
</html>
