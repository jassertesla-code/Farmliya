<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Farmliya â€” Ø´Ø­Ù† Ø´Ø¯Ø§Øª Ø¨Ø¨Ø¬ÙŠ (Ø§Ø­ØªØ±Ø§ÙÙŠ)</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg-overlay: rgba(3,6,10,0.55);
    --card: rgba(255,255,255,0.04);
    --gold1: #f0c75e;
    --gold2: #d9a441;
    --muted: #9fb0b7;
    --accent: linear-gradient(90deg,var(--gold1),var(--gold2));
  }
  html,body{height:100%;margin:0;font-family:'Tajawal',sans-serif;background:#041226;color:#eaf6f2;-webkit-font-smoothing:antialiased}
  /* Background image */
  .bg {
    position:fixed; inset:0; z-index:-3; background-image: url('https://wallpapercave.com/wp/wp10223146.jpg');
    background-size:cover; background-position:center; filter: blur(2px) brightness(.55);
  }
  .overlay { position:fixed; inset:0; background:linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.55)); z-index:-2; }

  .page { max-width:1180px; margin:28px auto; padding:20px; display:grid; grid-template-columns: 1fr 360px; gap:18px; align-items:start; }

  /* header */
  header{ grid-column:1 / -1; display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:6px }
  .brand { display:flex; align-items:center; gap:12px }
  .logo {
    width:72px;height:72px;border-radius:14px;
    background:var(--accent);
    display:flex; align-items:center; justify-content:center; color:#071018; font-weight:900; font-size:20px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.6), 0 0 12px rgba(240,199,94,0.12);
    transform-origin:center;
    animation:logo-pulse 3s infinite;
  }
  @keyframes logo-pulse { 0%{transform:rotate(-6deg) scale(1)} 50%{transform:rotate(6deg) scale(1.03)} 100%{transform:rotate(-6deg) scale(1)} }
  .title h1{margin:0;font-size:18px}
  .title p{margin:0;color:var(--muted);font-size:13px}

  /* tabs */
  nav.tabs { display:flex; gap:8px; align-items:center }
  .tab { padding:8px 14px;border-radius:10px; cursor:pointer; background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.03) }
  .tab.active { background: linear-gradient(90deg, rgba(240,199,94,0.12), rgba(217,164,65,0.08)); color: #fff; box-shadow: 0 8px 30px rgba(217,164,65,0.06) }

  /* main form card */
  .card { background:var(--card); border-radius:14px; padding:18px; border:1px solid rgba(255,255,255,0.03); box-shadow: 0 10px 30px rgba(0,0,0,0.6) }
  label{display:block;margin:8px 0 6px;color:var(--muted);font-size:13px}
  input[type="text"], input[type="number"], select, textarea {
    width:100%; padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:rgba(255,255,255,0.02); color:inherit; outline:none; font-size:15px;
  }
  textarea{resize:vertical; min-height:80px;}

  .row { display:flex; gap:10px }
  .col { flex:1 }

  .actions { display:flex; gap:10px; margin-top:12px; align-items:center; }
  .btn {
    padding:12px 16px;border-radius:12px;border:0;cursor:pointer;font-weight:800;
    background:var(--accent); color:#071018; box-shadow: 0 10px 30px rgba(217,164,65,0.12);
  }
  .btn.secondary{ background:transparent;color:var(--muted); border:1px solid rgba(255,255,255,0.04); box-shadow:none; font-weight:700 }

  .status { margin-top:10px; font-weight:700; color:var(--muted) }
  .danger{ color:#ff8b8b } .success{ color:#b7f3c1 }

  /* right column preview */
  .right { position:sticky; top:28px }
  .preview { background: linear-gradient(180deg, rgba(0,0,0,0.2), rgba(255,255,255,0.02)); padding:14px; border-radius:12px; border:1px solid rgba(255,255,255,0.03) }
  .preview h3{margin:0 0 10px 0}
  pre { white-space:pre-wrap; word-break:break-word; font-size:14px; color:#e8f9e9; background:transparent; margin:0 }

  .progress { height:10px; background:rgba(255,255,255,0.03); border-radius:8px; overflow:hidden; margin-top:10px }
  .progress > i { display:block; height:100%; width:0%; background: linear-gradient(90deg,var(--gold1),var(--gold2)); transition:width .25s ease }

  /* footer */
  footer{ grid-column:1 / -1; text-align:center; color:var(--muted); margin-top:18px; font-size:13px }

  /* responsive */
  @media (max-width:980px) {
    .page { grid-template-columns: 1fr; padding:12px }
    .right { position:relative; top:0 }
    .logo{width:56px;height:56px}
  }

  /* === Splash styles (keep with your dark/golden theme) === */
  #splashOverlay {
    position: fixed;
    inset: 0;
    z-index: 99999;
    background: linear-gradient(180deg, rgba(4,6,10,0.98), rgba(2,4,6,0.98));
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(3px);
    transition: opacity .45s ease, visibility .45s;
    visibility: visible;
    opacity: 1;
  }

  #splashOverlay.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

  .splash-center {
    width: min(520px, 92%);
    text-align: center;
    padding: 28px;
    border-radius: 14px;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    border: 1px solid rgba(255,255,255,0.04);
    box-shadow: 0 18px 50px rgba(0,0,0,0.6);
  }

  .splash-logo {
    width:84px; height:84px; border-radius:14px;
    margin: 0 auto 12px;
    display:flex; align-items:center; justify-content:center;
    background: linear-gradient(90deg,#f0c75e,#d9a441);
    color:#071018; font-weight:900; font-size:28px;
    box-shadow: 0 10px 30px rgba(217,164,65,0.08);
    transform-origin:center;
    animation: splashPulse 2.8s infinite;
  }
  @keyframes splashPulse { 0%{transform:scale(1)}50%{transform:scale(1.04)}100%{transform:scale(1)} }

  .splash-title { margin:6px 0 4px; font-size:22px; font-weight:800; color:#fff; letter-spacing:0.6px; }
  .splash-sub { margin:0 0 18px; color: #cfe6d9; font-size:14px; }

  .splash-progress-wrap {
    height:12px; background: rgba(255,255,255,0.04); border-radius:12px; overflow:hidden; margin: 10px 12px 8px;
  }
  .splash-progress-bar {
    height:100%; width:0%; background: linear-gradient(90deg,#f0c75e,#d9a441); transition: width .2s linear;
  }

  .splash-small { margin-top:8px; color:var(--muted); font-size:13px; }

</style>
</head>
<body>

  <!-- ===== Splash / Intro Overlay (no skip button) ===== -->
  <div id="splashOverlay" aria-hidden="true">
    <div class="splash-center">
      <div class="splash-logo">UC</div>
      <h2 class="splash-title">Farmliya</h2>
      <p class="splash-sub">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ â€” Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©ØŒ Ø§Ù†ØªØ¸Ø± Ù„Ø­Ø¸Ø©...</p>

      <div class="splash-progress-wrap">
        <div id="splashProgress" class="splash-progress-bar"></div>
      </div>

      <div class="splash-small">Ø³ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¹Ø¯ <span id="splashSeconds">5</span> Ø«ÙˆØ§Ù†Ù</div>
    </div>
  </div>
  <!-- ===== end Splash ===== -->

  <div class="bg"></div>
  <div class="overlay"></div>

  <div class="page">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden>UC</div>
        <div class="title">
          <h1>Farmliya â€” Ø´Ø­Ù† Ø´Ø¯Ø§Øª Ø¨Ø¨Ø¬ÙŠ</h1>
          <p>Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© â€” ÙˆØ§Ø¬Ù‡Ø© Ø¢Ù…Ù†Ø© ÙˆØ³Ù„Ø³Ø©</p>
        </div>
      </div>

      <nav class="tabs" role="tablist">
        <div class="tab active" data-tab="home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div class="tab" data-tab="history">Ø§Ù„Ø³Ø¬Ù„</div>
        <div class="tab" data-tab="about">Ø­ÙˆÙ„</div>
      </nav>
    </header>

    <!-- left: main content -->
    <main>
      <section id="home" class="card section active">
        <h2 style="margin:0 0 8px 0">âš¡ Ø§Ø´Ø­Ù† Ø´Ø¯Ø§Øª Ø¨Ø¨Ø¬ÙŠ Ø§Ù„Ø¢Ù†</h2>
        <p class="status muted">Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙˆØ³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Ø¨ÙˆØª Ø§Ù„ØªÙ„ÙŠØºØ±Ø§Ù… Ù…Ø¨Ø§Ø´Ø±Ø©.</p>

        <form id="chargeForm" autocomplete="off">
          <label>ğŸ® Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù„Ø§Ø¹Ø¨ (Player ID)</label>
          <input id="playerId" inputmode="numeric" type="text" placeholder="Ù…Ø«Ø§Ù„: 123456789" required>

          <div class="row">
            <div class="col">
              <label>ğŸ’° Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø¯Ø§Øª (UC)</label>
              <select id="ucAmount" required>
                <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ…ÙŠØ©</option>
                <option value="60">60 UC</option>
                <option value="300">300 UC</option>
                <option value="600">600 UC</option>
                <option value="1200">1200 UC</option>
                <option value="2800">2800 UC</option>
              </select>
            </div>
            <div class="col">
              <label>ğŸŒ Ø§Ù„Ø³ÙŠØ±ÙØ±</label>
              <select id="server" required>
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙŠØ±ÙØ±</option>
                <option value="ASIA">ASIA</option>
                <option value="EUROPE">EUROPE</option>
                <option value="NA">NORTH AMERICA</option>
                <option value="MENA">MENA</option>
              </select>
            </div>
          </div>

          <label>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="playerName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨">

          <div style="margin-top:12px">
            <label style="font-size:13px"><input id="consent" type="checkbox"> Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„ØªÙˆØ§ØµÙ„ ÙÙ‚Ø·.</label>
          </div>

          <div class="actions">
            <button id="sendBtn" class="btn" type="submit">Ø§Ø´Ø­Ù† Ø§Ù„Ø¢Ù† âš¡</button>
            <button id="clearBtn" type="button" class="btn secondary">Ù…Ø³Ø­</button>
            <button id="playDemo" type="button" class="btn secondary">âœ¦ Ù…Ø¹Ø§ÙŠÙ†Ø© ØµÙˆØª</button>
          </div>

          <div id="formStatus" class="status muted">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„.</div>
          <div class="progress" id="progressWrap" style="display:none"><i id="progressBar"></i></div>
        </form>
      </section>

      <section id="history" class="card section" style="display:none;margin-top:12px">
        <h3>Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©</h3>
        <div id="localLog" style="min-height:120px; max-height:360px; overflow:auto; padding:10px; background:rgba(0,0,0,0.25); border-radius:10px; color:#dff1df">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>
      </section>

      <section id="about" class="card section" style="display:none;margin-top:12px">
        <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Farmliya</h3>
        <p class="muted">ÙˆØ§Ø¬Ù‡Ø© Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ø´Ø­Ù† Ø´Ø¯Ø§Øª Ø¨Ø¨Ø¬ÙŠ â€” Ù…ØµÙ…Ù…Ø© Ù„ØªØ¬Ø±Ø¨Ø© Ø£Ù†ÙŠÙ‚Ø© ÙˆØ³Ø±ÙŠØ¹Ø©. Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØªÙØ±Ø³Ù„ Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ù„Ø¨ÙˆØª Ø§Ù„ØªÙ„ÙŠØºØ±Ø§Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ.</p>
        <p class="muted">ØªØ­Ø°ÙŠØ±: Ù„Ø§ ØªØ¶Ø¹ BOT_TOKEN ÙÙŠ Ù…Ø³ØªÙˆØ¯Ø¹ Ø¹Ø§Ù…. Ø§Ø­ÙØ¸Ù‡ ÙÙŠ Ù…Ù„Ù Ø¨ÙŠØ¦Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¥Ù† Ø£Ù…ÙƒÙ†.</p>
      </section>
    </main>

    <!-- right column -->
    <aside class="right">
      <div class="card preview">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3 style="margin:0">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©</h3>
          <div class="muted" style="font-size:13px">ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø§Ø´Ø±</div>
        </div>
        <pre id="preview">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯.</pre>

        <div style="margin-top:12px; display:flex; gap:8px; align-items:center">
          <button id="copyBtn" class="btn secondary">Ù†Ø³Ø®</button>
          <button id="downloadBtn" class="btn secondary">Ø­ÙØ¸ Ø³Ø¬Ù„</button>
        </div>

        <div style="margin-top:14px">
          <div class="muted">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>
          <div class="muted" style="font-size:13px; margin-top:6px">Ø³ØªØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ÙØ´Ù„ØŒ ÙˆØªØ®Ø²ÙŠÙ† Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø­Ù„ÙŠØ§Ù‹.</div>
        </div>
      </div>
    </aside>

    <footer>â’¸ Farmliya â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</footer>
  </div>

<script>
/* ================== CONFIG ==================
   Ø¶Ø¹ ØªÙˆÙƒÙ† Ø§Ù„Ø¨ÙˆØª Ùˆ chat id Ù‡Ù†Ø§ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·.
   Ù„Ø§ ØªØªØ±Ùƒ Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ Ù…Ø³ØªÙˆØ¯Ø¹ Ø¹Ø§Ù…!
*/
const BOT_TOKEN = "7917070284:AAG6dAMr4QeVDeoAtpltPsEbqpG3WXiOKpI"; // << Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ù†Ø§ Ø¥Ù† Ø£Ø±Ø¯Øª
const CHAT_ID = "5653032481";
const TELEGRAM_API = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
/* ============================================ */

const tabs = document.querySelectorAll('.tab');
const sections = document.querySelectorAll('.section');
tabs.forEach(t => t.addEventListener('click', () => {
  tabs.forEach(x => x.classList.remove('active'));
  t.classList.add('active');
  const id = t.dataset.tab;
  sections.forEach(s => s.style.display = s.id === id ? 'block' : 'none');
}));

// UI elements
const form = document.getElementById('chargeForm');
const playerIdEl = document.getElementById('playerId');
const playerNameEl = document.getElementById('playerName');
const ucEl = document.getElementById('ucAmount');
const serverEl = document.getElementById('server');
const consentEl = document.getElementById('consent');
const sendBtn = document.getElementById('sendBtn');
const clearBtn = document.getElementById('clearBtn');
const preview = document.getElementById('preview');
const statusEl = document.getElementById('formStatus');
const progressWrap = document.getElementById('progressWrap');
const progressBar = document.getElementById('progressBar');
const localLogEl = document.getElementById('localLog');
const copyBtn = document.getElementById('copyBtn');
const downloadBtn = document.getElementById('downloadBtn');
const playDemo = document.getElementById('playDemo');

let logs = [];

// small synthesized click sound using WebAudio
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx;
function playClick(){
  try{
    if(!audioCtx) audioCtx = new AudioCtx();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine';
    o.frequency.setValueAtTime(750, audioCtx.currentTime);
    g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.12, audioCtx.currentTime + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.35);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime + 0.36);
  }catch(e){ /* ignore */ }
}
playDemo.addEventListener('click', ()=> playClick());

// preview builder
function sanitize(s){ return String(s||'').replace(/[<>]/g,''); }
function buildText(data){
  return `ğŸ¯ Ø·Ù„Ø¨ Ø´Ø­Ù† Ø¬Ø¯ÙŠØ¯ (Farmliya)\nğŸ†” ID: ${sanitize(data.playerId)}\nğŸ’° UC: ${sanitize(data.uc)}\nğŸŒ Server: ${sanitize(data.server)}\nğŸ‘¤ Name: ${sanitize(data.playerName||'(ØºÙŠØ± Ù…ÙØ¯Ø®Ù„)')}\nğŸ•’ Time: ${new Date().toLocaleString()}\nğŸ”— Source: ${location.href}`;
}
function showPreview(){
  const data = {
    playerId: playerIdEl.value.trim(),
    playerName: playerNameEl.value.trim(),
    uc: ucEl.value,
    server: serverEl.value
  };
  preview.textContent = buildText(data);
}

// live preview
[playerIdEl, playerNameEl, ucEl, serverEl].forEach(el => el.addEventListener('input', showPreview));

copyBtn.addEventListener('click', async ()=>{
  try{
    await navigator.clipboard.writeText(preview.textContent || '');
    alert('ØªÙ… Ø§Ù„Ù†Ø³Ø®!');
  }catch(e){ alert('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®'); }
});

downloadBtn.addEventListener('click', ()=>{
  const blob = new Blob([localLogEl.textContent], { type:'text/plain;charset=utf-8' });
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
  a.download = 'farmliya_logs.txt'; document.body.appendChild(a); a.click(); a.remove();
});

// local logs load/save
function appendLog(obj){
  logs.unshift(obj);
  if(logs.length>200) logs.pop();
  localLogEl.textContent = logs.map(l => `[${l.time}] ${l.status} - ${l.summary}`).join("\n\n");
  try{ localStorage.setItem('farmliya_logs', JSON.stringify(logs.slice(0,100))); }catch(e){}
}
(function loadLogs(){
  try{
    const saved = JSON.parse(localStorage.getItem('farmliya_logs')||'[]');
    if(saved.length){ logs = saved; appendLog({time:new Date().toLocaleString(),status:'INFO',summary:`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${saved.length} Ø³Ø¬Ù„ Ù…Ø­Ù„ÙŠÙ‹Ø§`}); }
    else localLogEl.textContent = 'ÙØ§Ø±Øº';
  }catch(e){ localLogEl.textContent = 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ù„ÙŠ'; }
})();

// progress
function setProgress(p){ progressBar.style.width = p + '%'; }

// send handler with retries
form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  playClick();

  // validation
  const pid = playerIdEl.value.trim();
  const uc = ucEl.value;
  const server = serverEl.value;
  const pname = playerNameEl.value.trim();
  const consent = consentEl.checked;

  if(!pid || !/^\d+$/.test(pid)){ statusEl.innerHTML = '<span class="danger">Ø£Ø¯Ø®Ù„ Player ID ØµØ§Ù„Ø­ (Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·).</span>'; return; }
  if(!uc){ statusEl.innerHTML = '<span class="danger">Ø§Ø®ØªØ± ÙƒÙ…ÙŠØ© Ø§Ù„Ø´Ø¯Ø§Øª.</span>'; return; }
  if(!server){ statusEl.innerHTML = '<span class="danger">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙŠØ±ÙØ±.</span>'; return; }
  if(!consent){ statusEl.innerHTML = '<span class="danger">ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</span>'; return; }

  const payloadText = buildText({playerId:pid, playerName:pname, uc, server});

  // UI prepare
  sendBtn.disabled = true; sendBtn.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
  statusEl.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Ø§Ù„ØªÙ„ÙŠØºØ±Ø§Ù…...'; statusEl.classList.remove('danger','success');
  progressWrap.style.display = 'block'; setProgress(10);

  const maxRetries = 3;
  let attempt = 0, ok = false, lastErr = null;

  while(attempt < maxRetries && !ok){
    attempt++;
    try{
      setProgress(10 + attempt*20);
      const resp = await fetch(TELEGRAM_API, {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ chat_id: CHAT_ID, text: payloadText })
      });
      const j = await resp.json().catch(()=>({ok:resp.ok}));
      if(resp.ok && (j.ok || j.result)){
        ok = true;
        setProgress(100);
        statusEl.innerHTML = '<span class="success">âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­! Ø³ØªØªÙ„Ù‚Ù‰ Ø¥Ø´Ø¹Ø§Ø±Ù‹Ø§ ÙÙŠ Ø¨ÙˆØª Ø§Ù„ØªÙ„ÙŠØºØ±Ø§Ù….</span>';
        appendLog({ time:new Date().toLocaleString(), status:'SUCCESS', summary:`ID=${pid} UC=${uc} server=${server}` });
        form.reset(); showPreview();
        break;
      } else {
        lastErr = j;
        throw new Error(JSON.stringify(j));
      }
    }catch(err){
      lastErr = err;
      statusEl.innerHTML = `<span class="danger">Ø®Ø·Ø£ Ø¨Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (Ù…Ø­Ø§ÙˆÙ„Ø© ${attempt}): ${sanitize(String(err).slice(0,120))}</span>`;
      appendLog({ time:new Date().toLocaleString(), status:'RETRY', summary:`Attempt ${attempt} failed`});
      await new Promise(r => setTimeout(r, 700 * attempt));
    }
  }

  if(!ok){
    statusEl.innerHTML += `<div class="muted">ÙØ´Ù„ Ù†Ù‡Ø§Ø¦ÙŠ. ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø£Ùˆ Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„.</div>`;
    appendLog({ time:new Date().toLocaleString(), status:'FAILED', summary:`ID=${pid} UC=${uc} server=${server}: ${String(lastErr).slice(0,80)}`});
    try{ await navigator.clipboard.writeText(payloadText); }catch(e){}
  }

  // reset UI
  sendBtn.disabled = false; sendBtn.textContent = 'Ø§Ø´Ø­Ù† Ø§Ù„Ø¢Ù† âš¡';
  setTimeout(()=>{ progressWrap.style.display='none'; setProgress(0); }, 900);
});

// clear
clearBtn.addEventListener('click', ()=>{ form.reset(); showPreview(); statusEl.textContent = 'ØªÙ… Ø§Ù„Ù…Ø³Ø­.'; });

// initial preview
showPreview();
</script>

<!-- Splash control script (no skip) -->
<script>
(function(){
  const overlay = document.getElementById('splashOverlay');
  const prog = document.getElementById('splashProgress');
  const secSpan = document.getElementById('splashSeconds');

  // Ù…Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
  const DURATION = 5;
  let intervalId = null;
  let start = null;

  function startSplash() {
    start = performance.now();
    if(intervalId) clearInterval(intervalId);
    intervalId = setInterval(() => {
      const elapsed = (performance.now() - start) / 1000; // seconds
      const pct = Math.min(100, (elapsed / DURATION) * 100);
      prog.style.width = pct + '%';
      const left = Math.max(0, Math.ceil(DURATION - elapsed));
      secSpan.textContent = left;
      if(elapsed >= DURATION) finishSplash();
    }, 80);
  }

  function finishSplash() {
    if(intervalId) { clearInterval(intervalId); intervalId = null; }
    overlay.classList.add('hidden');
    setTimeout(()=> { try{ overlay.remove(); }catch(e){} }, 600);
  }

  window.addEventListener('load', () => {
    // Ø¨Ø¯Ø§ÙŠØ© Ù…ØªØ£Ø®Ø±Ø© Ù‚Ù„ÙŠÙ„Ù‹Ø§ ÙƒÙŠ ÙŠØªØ­Ø¶Ø± Ø§Ù„Ø®Ù„ÙÙŠÙ‘Ø©
    setTimeout(startSplash, 120);
  });
})();
</script>

</body>
</html>
