<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Farmliya â€” Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª PUBG</title>
  <style>
    :root{--gold1:#f0c75e;--gold2:#d9a441;--muted:#9fb0b7}
    *{box-sizing:border-box}
    body{margin:0;font-family:Tahoma,Arial;background:#041226;color:#eaf6f2}
    .wrap{max-width:980px;margin:24px auto;padding:18px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .logo{display:flex;align-items:center;gap:12px}
    .badge{width:58px;height:58px;border-radius:12px;background:linear-gradient(90deg,var(--gold1),var(--gold2));display:flex;align-items:center;justify-content:center;color:#071018;font-weight:900}
    h1{margin:0}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .card{background:rgba(255,255,255,0.03);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    input,select,button,textarea{font-family:inherit;font-size:15px}
    input[type="text"],select,textarea{width:100%;padding:10px;border-radius:9px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:inherit}
    .row{display:flex;gap:10px}
    .col{flex:1}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;background:linear-gradient(90deg,var(--gold1),var(--gold2));color:#071018;font-weight:800}
    .btn.secondary{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03)}
    .result{margin-top:10px;padding:10px;border-radius:10px;background:rgba(0,0,0,0.18);font-size:14px}
    pre{white-space:pre-wrap;margin:0}
    footer{text-align:center;color:var(--muted);margin-top:18px}
    @media(max-width:900px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">
        <div class="badge">UC</div>
        <div>
          <h1>Farmliya</h1>
          <div class="muted">Ø´Ø­Ù† + Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª PUBG (ØªØ¬Ø±ÙŠØ¨ÙŠ)</div>
        </div>
      </div>
      <div class="muted">Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</div>
    </header>

    <nav style="margin-bottom:12px">
      <button class="btn active" id="tabHome">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <button class="btn secondary" id="tabStats">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨</button>
    </nav>

    <div class="grid">
      <!-- main column -->
      <main>
        <!-- Home (charge) -->
        <section id="homeSection" class="card">
          <h3 style="margin-top:0">âš¡ Ø´Ø­Ù† Ø´Ø¯Ø§Øª Ø¨Ø¨Ø¬ÙŠ</h3>
          <form id="chargeForm">
            <label>ğŸ® Player ID</label>
            <input id="playerId" type="text" placeholder="Ù…Ø«Ø§Ù„: 123456789" required>

            <div class="row" style="margin-top:8px">
              <div class="col">
                <label>ğŸ’° UC</label>
                <select id="ucAmount" required>
                  <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ…ÙŠØ©</option>
                  <option value="60">60</option>
                  <option value="300">300</option>
                  <option value="600">600</option>
                  <option value="1200">1200</option>
                </select>
              </div>
              <div class="col">
                <label>ğŸŒ Ø§Ù„Ø³ÙŠØ±ÙØ±</label>
                <select id="server" required>
                  <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙŠØ±ÙØ±</option>
                  <option value="ASIA">ASIA</option>
                  <option value="EUROPE">EUROPE</option>
                  <option value="NA">NA</option>
                </select>
              </div>
            </div>

            <label style="margin-top:8px">ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="playerName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨">

            <div style="margin-top:10px">
              <label><input id="consent" type="checkbox"> Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</label>
            </div>

            <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn" type="submit">Ø§Ø´Ø­Ù† Ø§Ù„Ø¢Ù†</button>
              <button class="btn secondary" id="clearCharge" type="button">Ù…Ø³Ø­</button>
            </div>

            <div id="chargeStatus" class="result" style="display:none"></div>
          </form>
        </section>

        <!-- Stats section -->
        <section id="statsSection" class="card" style="display:none">
          <h3 style="margin-top:0">ğŸ” Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ (PUBG)</h3>
          <p class="muted">Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ (player name) Ø£Ùˆ Player ID ÙˆØ§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ© Ø«Ù… Ø§Ø¶ØºØ· "Ø¬Ù„Ø¨".</p>

          <div style="display:grid;grid-template-columns:1fr 160px;gap:10px">
            <input id="statQuery" type="text" placeholder="Ù…Ø«Ø§Ù„: someplayer Ø£Ùˆ account-id-xxxx">
            <select id="statPlatform">
              <option value="steam">PC (Steam)</option>
              <option value="psn">PlayStation</option>
              <option value="xbox">Xbox</option>
              <option value="kakao">Kakao (KR)</option>
            </select>
          </div>

          <div style="margin-top:10px;display:flex;gap:8px">
            <button id="fetchPlayer" class="btn">Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨</button>
            <button id="fetchSeason" class="btn secondary">Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ù…ÙˆØ³Ù…</button>
          </div>

          <div style="margin-top:10px">
            <label>Season ID (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¡Ø§Øª Ù…ÙˆØ³Ù… Ù…Ø­Ø¯Ø¯)</label>
            <input id="seasonInput" type="text" placeholder="Ù…Ø«Ø§Ù„: division.bro.official.pc-2018 (Ø§ØªØ±ÙƒÙ‡ Ø¥Ù† Ù„Ù… ØªÙƒÙ† ØªÙ…Ù„Ùƒ)"/>
          </div>

          <div id="statsResult" class="result" style="display:none"></div>
        </section>
      </main>

      <!-- sidebar -->
      <aside>
        <div class="card">
          <h4 style="margin:0 0 8px 0">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h4>
          <p class="muted" style="font-size:13px">
            Ø³ÙƒØ±Ø¨Øª ÙŠØ·Ù„Ø¨ Ø§Ù„Ù€PUBG Developer API Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­. Ø¥Ø°Ø§ ÙˆØ¶Ø¹Øª Ø§Ù„ØªÙˆÙƒÙ† Ø¯Ø§Ø®Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„ÙØŒ ÙØ³ÙŠØ¸Ù‡Ø± Ù„Ø£ÙŠ Ù…Ù† ÙŠÙØ­Øµ Ø§Ù„ØµÙØ­Ø©.
            Ø§Ø³ØªØ®Ø¯Ù…Ù‡ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙ‚Ø·. Ù„Ù„Ø­Ù…Ø§ÙŠØ© Ù„Ø§Ø­Ù‚Ù‹Ø§ØŒ Ø§Ù†Ù‚Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¥Ù„Ù‰ Backend.
          </p>
          <div style="margin-top:10px">
            <strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</strong>
            <div id="sideLog" style="margin-top:8px;font-size:14px;color:var(--muted)">Ø¬Ø§Ù‡Ø²</div>
          </div>
        </div>
      </aside>
    </div>

    <footer>â’¸ Farmliya</footer>
  </div>

<script>
/* ====== Ø¶Ø¹ Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø°ÙŠ Ø£Ø¹Ø·ÙŠØªÙÙ‡ Ù‡Ù†Ø§ Ø¨Ø§Ù„Ø¶Ø¨Ø· ======
   (Ø§Ù„Ù…ÙØªØ§Ø­ Ø³ÙŠØµØ¨Ø­ Ù…ÙƒØ´ÙˆÙÙ‹Ø§ Ù„Ù„Ù…ØªØµÙØ­ â€“ Ø£Ù†Øª ÙˆØ§ÙÙ‚Øª)
*/
const PUBG_API_KEY = "eyJ0eXAiOiJKV1QiOiJkYcGlbGhbcGlGiOiJIUzI1NiJ9.eyJqdGkI0iI3YZFjMTcyMC05YmI5LTAxM2UtMmUzMmU0OC0yNmQxYjtiMzY4ZGYiLCJpc3MiOiJnYw1lbG9jMzAyVyIsImFfF0IjoxNzYyMTcy0TUwLCIzdWdI0IjoiJibgYWIa9GZzSlslnRPdGxlIjoiCHVIZYlmFwCCl6ImIzMcm1lcXIhln0z0zY7xY2IyZGlmFwCCl6ImIzMcm1lcXIhln0z0zY7XY2IzZGlmFwCCl6ImIzMcm1lcXIhln0z0zY7XNvZGhU2hlZFAnZEJVQGgTIBU5tD577XZQ1A8hhiC8";
/* ================================================== */

/* Default platform for queries (you can change in UI) */
const DEFAULT_BASE = "https://api.pubg.com/shards";

/* helpers */
const $ = id => document.getElementById(id);
function show(el, html){ el.style.display='block'; el.innerHTML = html; }
function hide(el){ el.style.display='none'; }

/* tabs */
$('tabHome').addEventListener('click', ()=> {
  $('homeSection').style.display='block';
  $('statsSection').style.display='none';
});
$('tabStats').addEventListener('click', ()=> {
  $('homeSection').style.display='none';
  $('statsSection').style.display='block';
});

/* small logger */
function logSide(msg){ $('sideLog').textContent = msg; }

/* ====== Charge form behavior (keeps local record â€” no telegram proxy here) ====== */
$('chargeForm').addEventListener('submit', (e)=>{
  e.preventDefault();
  const playerId = $('playerId').value.trim();
  const uc = $('ucAmount').value;
  const server = $('server').value;
  const playerName = $('playerName').value.trim();
  const consent = $('consent').checked;
  const status = $('chargeStatus');

  status.style.display = 'block';
  if(!playerId || !uc || !server || !consent){
    status.innerHTML = '<span style="color:#ff9b9b">Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙˆÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù….</span>';
    return;
  }

  // Save locally (safer than exposing telegram token)
  const logs = JSON.parse(localStorage.getItem('farm_logs')||'[]');
  logs.unshift({time:new Date().toLocaleString(), playerId, uc, server, playerName});
  localStorage.setItem('farm_logs', JSON.stringify(logs.slice(0,200)));
  status.innerHTML = '<span style="color:#b7f3c1">ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹. Ø£Ù†ØµØ­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Backend Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ„ÙŠØºØ±Ø§Ù… Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø¢Ù…Ù†Ø©.</span>';
});

/* clear charge form */
$('clearCharge').addEventListener('click', ()=> {
  $('chargeForm').reset();
  $('chargeStatus').style.display='none';
});

/* ====== PUBG API calls (client-side, using your key) ====== */

async function apiFetch(path){
  const url = path.startsWith('http') ? path : `${DEFAULT_BASE}/${path}`;
  const resp = await fetch(url, {
    headers: {
      'Authorization': `Bearer ${PUBG_API_KEY}`,
      'Accept': 'application/vnd.api+json'
    }
  });
  if(!resp.ok){
    const txt = await resp.text().catch(()=>resp.statusText);
    throw { status: resp.status, text: txt };
  }
  return await resp.json();
}

/* helper: try get player by name or id */
async function resolvePlayer(query, platform){
  // If query looks like an id (contains '-' or long digits) try direct GET /players/{id}
  if(query.includes('-') || query.length > 16 || /^\d+$/.test(query)) {
    try{
      const json = await apiFetch(`${platform}/players/${encodeURIComponent(query)}`);
      return json;
    }catch(e){
      // fallback to name search
    }
  }
  // name search
  const json = await apiFetch(`${platform}/players?filter[playerNames]=${encodeURIComponent(query)}`);
  return json;
}

/* fetch player basic info + attempt last match */
$('fetchPlayer').addEventListener('click', async ()=>{
  const q = $('statQuery').value.trim();
  const platform = $('statPlatform').value || 'steam';
  const out = $('statsResult');
  out.style.display = 'block';
  if(!q){ out.innerHTML = '<span class="muted">Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø£Ùˆ Player ID.</span>'; return; }
  if(!PUBG_API_KEY || PUBG_API_KEY.includes('PASTE')){ out.innerHTML = '<span style="color:#ff9b9b">Ø¶Ø¹ Ù…ÙØªØ§Ø­ PUBG ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ± PUBG_API_KEY Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ù.</span>'; return; }

  out.innerHTML = 'ğŸ”„ Ø¬Ø§Ø±Ù Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨...';
  logSide('Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨...');

  try{
    const pjson = await resolvePlayer(q, platform);
    // find player object
    let pdata = null;
    if(pjson.data && Array.isArray(pjson.data)) pdata = pjson.data[0];
    else if(pjson.data) pdata = pjson.data;
    else throw { message: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§Ø¹Ø¨' };

    const pid = pdata.id;
    const name = (pdata.attributes && pdata.attributes.name) || '(ØºÙŠØ± Ù…ØªØ§Ø­)';
    const createdAt = (pdata.attributes && pdata.attributes.createdAt) || null;

    // try to fetch first related match for last activity (best-effort)
    let lastMatchTime = null;
    try{
      const rels = (pdata.relationships) || {};
      const matches = (rels.matches && rels.matches.data) || [];
      if(matches.length){
        const matchId = matches[0].id;
        const mjson = await apiFetch(`${platform}/matches/${encodeURIComponent(matchId)}`);
        lastMatchTime = mjson.data && mjson.data.attributes && mjson.data.attributes.createdAt;
      }
    }catch(e){ /* ignore */ }

    let html = `<div><strong>Ø§Ù„Ù„Ø§Ø¹Ø¨:</strong> ${name} <small class="muted">(${pid})</small></div>`;
    html += `<div><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</strong> ${createdAt ? new Date(createdAt).toLocaleString() : 'ØºÙŠØ± Ù…ØªØ§Ø­'}</div>`;
    html += `<div><strong>Ø¢Ø®Ø± Ù…Ø¨Ø§Ø±Ø§Ø© Ù…Ø³Ø¬Ù„Ø©:</strong> ${lastMatchTime ? new Date(lastMatchTime).toLocaleString() : 'Ù„Ø§ ØªÙˆØ¬Ø¯'}</div>`;
    html += `<div style="margin-top:8px" class="muted">Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ù‡ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù…Ù† API Ø§Ù„Ø±Ø³Ù…ÙŠ â€” Ù„Ø§ ØªÙ…Ø«Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© (online/offline).</div>`;

    out.innerHTML = html;
    logSide('ØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨.');
  }catch(err){
    console.error(err);
    const msg = (err && (err.message || err.text)) || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
    out.innerHTML = `<span style="color:#ff9b9b">Ø®Ø·Ø£: ${msg}</span>`;
    logSide('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
  }
});

/* fetch season stats (requires valid Season ID) */
$('fetchSeason').addEventListener('click', async ()=>{
  const q = $('statQuery').value.trim();
  const platform = $('statPlatform').value || 'steam';
  const season = $('seasonInput').value.trim();
  const out = $('statsResult');
  out.style.display = 'block';
  if(!q){ out.innerHTML = '<span class="muted">Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø£Ùˆ Player ID.</span>'; return; }
  if(!season){ out.innerHTML = '<span class="muted">Ø£Ø¯Ø®Ù„ Season ID ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ØµÙ‘Øµ.</span>'; return; }
  if(!PUBG_API_KEY || PUBG_API_KEY.includes('PASTE')){ out.innerHTML = '<span style="color:#ff9b9b">Ø¶Ø¹ Ù…ÙØªØ§Ø­ PUBG ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ± PUBG_API_KEY Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ù.</span>'; return; }

  out.innerHTML = 'ğŸ”„ Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ù…ÙˆØ³Ù…...';
  logSide('Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ù…ÙˆØ³Ù…...');

  try{
    // resolve player id first
    let playerJson = await resolvePlayer(q, platform);
    let pdata = null;
    if(playerJson.data && Array.isArray(playerJson.data)) pdata = playerJson.data[0];
    else if(playerJson.data) pdata = playerJson.data;
    else throw { message: 'Ù„Ù… ÙŠØ¹Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø§Ø¹Ø¨' };

    const playerId = pdata.id;
    const seasonJson = await apiFetch(`${platform}/players/${encodeURIComponent(playerId)}/seasons/${encodeURIComponent(season)}`);

    const attrs = (seasonJson.data && seasonJson.data.attributes) || {};
    const stats = attrs.gameModeStats || attrs || {};

    let html = `<div><strong>Ø§Ù„Ù„Ø§Ø¹Ø¨:</strong> ${playerId}</div>`;
    html += `<div><strong>Season:</strong> ${season}</div>`;

    if(stats && typeof stats === 'object' && Object.keys(stats).length){
      html += `<div style="margin-top:8px"><strong>Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø­Ø³Ø¨ Ù†Ù…Ø· Ø§Ù„Ù„Ø¹Ø¨:</strong></div>`;
      for(const mode of Object.keys(stats)){
        const s = stats[mode];
        html += `<div style="margin:6px 0;padding:8px;border-radius:8px;background:rgba(0,0,0,0.12)"><strong>${mode}</strong><br/>`;
        const keys = ['roundsPlayed','wins','kills','assists','damageDealt','longestKill','timeSurvived','kd'];
        for(const k of keys){
          if(s[k] !== undefined) html += `<small class="muted">${k}:</small> ${s[k]} &nbsp;`;
        }
        html += `</div>`;
      }
    } else {
      html += `<div class="muted">Ù„Ù… ØªÙØ±Ø¬Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ³Ù… ÙˆØ§Ø¶Ø­Ø© â€” ØªØ£ÙƒØ¯ Ù…Ù† Season ID.</div>`;
    }

    out.innerHTML = html;
    logSide('ØªÙ… Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ù…ÙˆØ³Ù….');
  }catch(err){
    console.error(err);
    const msg = (err && (err.message || err.text)) || 'Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ù…ÙˆØ³Ù…';
    out.innerHTML = `<span style="color:#ff9b9b">Ø®Ø·Ø£: ${msg}</span>`;
    logSide('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¡Ø§Øª Ø§Ù„Ù…ÙˆØ³Ù…');
  }
});
</script>
</body>
</html>
